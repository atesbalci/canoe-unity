window.__require=function e(t,n,o){function r(c,a){if(!n[c]){if(!t[c]){var i=c.split("/");if(i=i[i.length-1],!t[i]){var u="function"==typeof __require&&__require;if(!a&&u)return u(i,!0);if(s)return s(i,!0);throw new Error("Cannot find module '"+c+"'")}}var p=n[c]={exports:{}};t[c][0].call(p.exports,function(e){return r(t[c][1][e]||e)},p,p.exports,e,t,n,o)}return n[c].exports}for(var s="function"==typeof __require&&__require,c=0;c<o.length;c++)r(o[c]);return r}({ChangeAvatarMessage:[function(e,t,n){"use strict";cc._RF.push(t,"f9e4evBne5Je6t9ev7rndLT","ChangeAvatarMessage");var o=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../../../../Managers/WebSocket/Message"),s=e("../MessageCodes"),c=function(e){function t(t){var n=e.call(this,s.MessageCodes.ChangeAvatar)||this;return n.avatarId=t,n}return o(t,e),t}(r.Message);n.ChangeAvatarMessage=c,cc._RF.pop()},{"../../../../../Managers/WebSocket/Message":"Message","../MessageCodes":"MessageCodes"}],ChangeStateMessage:[function(e,t,n){"use strict";cc._RF.push(t,"68f5d4MORtMdIn47zfH0fPj","ChangeStateMessage");var o=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../../../../Managers/WebSocket/Message"),s=e("../MessageCodes"),c=function(e){function t(t){var n=e.call(this,s.MessageCodes.ChangeState)||this;return n.isReady=t,n}return o(t,e),t}(r.Message);n.ChangeStateMessage=c,cc._RF.pop()},{"../../../../../Managers/WebSocket/Message":"Message","../MessageCodes":"MessageCodes"}],GameManager:[function(e,t,n){"use strict";cc._RF.push(t,"241e3txZFJIyLv8a53fkhCS","GameManager");var o=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),r=this&&this.__decorate||function(e,t,n,o){var r,s=arguments.length,c=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(c=(s<3?r(c):s>3?r(t,n,c):r(t,n))||c);return s>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0});var s=e("../../Models/UserModel"),c=e("../../Helper"),a=cc._decorator,i=a.ccclass,u=a.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.User=void 0,t}return o(t,e),t.prototype.onLoad=function(){this.User=new s.UserModel,this.User.avatarId=c.Helper.getRandomNumber(0,15)},t.prototype.start=function(){},r([u],t.prototype,"User",void 0),t=r([i],t)}(cc.Component);n.default=p,cc._RF.pop()},{"../../Helper":"Helper","../../Models/UserModel":"UserModel"}],GamepadScreenResources:[function(e,t,n){"use strict";cc._RF.push(t,"cc7dclkTshEIYYDthJzW7nW","GamepadScreenResources");var o=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),r=this&&this.__decorate||function(e,t,n,o){var r,s=arguments.length,c=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(c=(s<3?r(c):s>3?r(t,n,c):r(t,n))||c);return s>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0});var s=cc._decorator,c=s.ccclass,a=s.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.avatarFrames=[],t}return o(t,e),t.prototype.start=function(){},r([a({type:[cc.SpriteFrame]})],t.prototype,"avatarFrames",void 0),t=r([c],t)}(cc.Component);n.default=i,cc._RF.pop()},{}],GamepadScreen:[function(e,t,n){"use strict";cc._RF.push(t,"9b4d71364VLnrHQbMQBgpA7","GamepadScreen");var o=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),r=this&&this.__decorate||function(e,t,n,o){var r,s=arguments.length,c=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(c=(s<3?r(c):s>3?r(t,n,c):r(t,n))||c);return s>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0});var s=e("./GamepadScreenResources"),c=e("../../Managers/WebSocket/WebSocketManager"),a=e("./Systems/UI/UISystem"),i=e("./Systems/MessageFactory/Messages/ChangeAvatarMessage"),u=e("../../Models/UserModel"),p=e("../../Managers/Game/GameManager"),f=e("../../Helper"),d=e("./Systems/MessageFactory/Messages/ChangeStateMessage"),l=cc._decorator,h=l.ccclass,g=(l.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.onLoad=function(){var e=this;this._resources=this.getComponent(s.default),this._gameManager=this.getComponent(p.default),this._wsManager=this.getComponent(c.default),this._wsManager.onConnect=function(){return e.onConnect()},this._wsManager.onDisconnect=function(){return e.onDisconnect()},this._wsManager.onErrorOccur=function(){return e.onErrorOccur()},this._wsManager.onMessageReceive=function(t){return e.onMessageReceive(t)},this._uiSystem=this.getComponent(a.default),this._uiSystem.onChangeAvatarButtonClick=function(t){return e.onChangeAvatarButtonClick(t)},this._uiSystem.onChangeStateButtonClick=function(t){return e.onChangeStateButtonClick(t)},this._uiSystem.onReconnectButtonClick=function(){return e.onReconnectButtonClick()},this._userModel=new u.UserModel},t.prototype.start=function(){this.connect()},t.prototype.connect=function(){var e=f.Helper.getURLHost();this._uiSystem.enableConnectingStage(),this._wsManager.connect(e,81)},t.prototype.onConnect=function(){this._uiSystem.enableLobbyStage(),this._uiSystem.changeAvatar(this._gameManager.User.avatarId),this._wsManager.send(new i.ChangeAvatarMessage(this._gameManager.User.avatarId))},t.prototype.onDisconnect=function(){this._uiSystem.enableDisconnectedStage()},t.prototype.onErrorOccur=function(){console.log("onErrorOccur")},t.prototype.onMessageReceive=function(e){console.log("onMessageReceive: "+e)},t.prototype.onChangeAvatarButtonClick=function(e){this._gameManager.User.avatarId=e,this._uiSystem.changeAvatar(e),this._wsManager.send(new i.ChangeAvatarMessage(e))},t.prototype.onChangeStateButtonClick=function(e){this._gameManager.User.isReady=e,this._uiSystem.changeState(!e),this._wsManager.send(new d.ChangeStateMessage(e))},t.prototype.onReconnectButtonClick=function(){this.connect()},t.prototype.createUserModel=function(){this._userModel=new u.UserModel},t=r([h],t)}(cc.Component));n.default=g,cc._RF.pop()},{"../../Helper":"Helper","../../Managers/Game/GameManager":"GameManager","../../Managers/WebSocket/WebSocketManager":"WebSocketManager","../../Models/UserModel":"UserModel","./GamepadScreenResources":"GamepadScreenResources","./Systems/MessageFactory/Messages/ChangeAvatarMessage":"ChangeAvatarMessage","./Systems/MessageFactory/Messages/ChangeStateMessage":"ChangeStateMessage","./Systems/UI/UISystem":"UISystem"}],Helper:[function(e,t,n){"use strict";cc._RF.push(t,"29aa8lZT6JD+4kEuWCFp3cI","Helper"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(){}return e.getURLHost=function(){return window.location.host.split(":")[0]},e.getRandomNumber=function(e,t){return Math.floor(Math.random()*(t-e+1)+e)},e}();n.Helper=o,cc._RF.pop()},{}],MessageCodes:[function(e,t,n){"use strict";cc._RF.push(t,"65c6bkcl25Ln71GwcEj0CdE","MessageCodes"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(){}return e.ChangeAvatar=10,e.ChangeState=11,e}();n.MessageCodes=o,cc._RF.pop()},{}],MessageFactorySystem:[function(e,t,n){"use strict";cc._RF.push(t,"74ab9UJEDhKsZVOQO5D58C7","MessageFactorySystem");var o=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),r=this&&this.__decorate||function(e,t,n,o){var r,s=arguments.length,c=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(c=(s<3?r(c):s>3?r(t,n,c):r(t,n))||c);return s>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(){}return e.ChangeAvatar=10,e}(),c=(function(e){function t(t){var n=e.call(this,s.ChangeAvatar)||this;return n.avatarId=t,n}o(t,e)}(function(){return function(e){this.code=e}}()),cc._decorator),a=c.ccclass,i=c.property,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.label=null,t.text="hello",t}return o(t,e),t.prototype.start=function(){},r([i(cc.Label)],t.prototype,"label",void 0),r([i],t.prototype,"text",void 0),t=r([a],t)}(cc.Component);n.default=u,cc._RF.pop()},{}],Message:[function(e,t,n){"use strict";cc._RF.push(t,"5f3e3cEdkBE17bB7hLryZjf","Message"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e){this.code=e}return e.prototype.toJson=function(){return JSON.stringify(this)},e}();n.Message=o,cc._RF.pop()},{}],Realtime:[function(e,t,n){"use strict";cc._RF.push(t,"62805ep1JdIh4MN/S/zEI9i","Realtime"),Object.defineProperty(n,"__esModule",{value:!0});var o,r=function(){function e(e,t,n){this.id=e,this.data=t,this.sender=n}return e.prototype.addTarget=function(e){void 0===this.targets&&(this.targets=[]),-1===this.targets.indexOf(e.peerId)&&this.targets.push(e.peerId)},e.parse=function(e){return JSON.parse(e)},e}();(function(e){e[e.Welcome=0]="Welcome",e[e.UserConnect=1]="UserConnect",e[e.UserDisconnect=2]="UserDisconnect"})(o||(o={}));var s=function(){return function(){}}();n.User=s;var c=function(){function e(e,t,n){this.host=e,this.port=t,this.accessToken=n}return e.prototype.setConnectHandler=function(e){this.connectHandler=e},e.prototype.setDisconnectHandler=function(e){this.disconnectHandler=e},e.prototype.setReceiveHandler=function(e){this.receiveHandler=e},e.prototype.setErrorHandler=function(e){this.errorHandler=e},e.prototype.setUserConnectHandler=function(e){this.userConnectHandler=e},e.prototype.setUserDisconnectHandler=function(e){this.userDisconnectHandler=e},e.prototype.connect=function(){var e=this;this.ws=new WebSocket("ws://"+this.host+":"+this.port+"?access_token="+this.accessToken),this.ws.onclose=function(t){void 0!==e.disconnectHandler&&1006!==t.code&&e.disconnectHandler()},this.ws.onmessage=function(t){var n=r.parse(t.data);switch(n.id){case o.Welcome:var s=n.data;e.bindUsers(s),void 0!==e.connectHandler&&e.connectHandler();break;case o.UserConnect:var c=n.data,a=e.bindUser(c);void 0!==e.userConnectHandler&&e.userConnectHandler(a);break;case o.UserDisconnect:var i=n.data;a=e.unbindUser(i);void 0!==e.userDisconnectHandler&&e.userDisconnectHandler(a);break;default:if(void 0===e.receiveHandler)return;a=e.findUserByPeerId(n.sender);e.receiveHandler(n.id,n.data,a)}},this.ws.onerror=function(t){void 0!==e.errorHandler&&e.errorHandler()}},e.prototype.disconnect=function(){this.ws.readyState===WebSocket.OPEN&&this.ws.close()},e.prototype.isConnected=function(){return void 0!==this.ws&&this.ws.readyState===WebSocket.OPEN},e.prototype.bindUsers=function(e){this.me=e.me,this.users=e.users,this.connectedUsersByPeerId={};for(var t=0,n=this.users;t<n.length;t++){var o=n[t];null!==o&&(this.connectedUsersByPeerId[o.peerId]=o)}},e.prototype.bindUser=function(e){var t=this.findUserByPeerId(e.peerId);return this.connectedUsersByPeerId[t.peerId]=t,t},e.prototype.unbindUser=function(e){var t=this.findUserByPeerId(e.peerId);return delete this.connectedUsersByPeerId[t.peerId],t},e.prototype.findUserByPeerId=function(e){return 1<=e&&e<=this.users.length?this.users[e-1]:null},e.prototype.sendPacket=function(e){var t=JSON.stringify(e);this.ws.send(t)},e.prototype.sendPacketToUser=function(e,t,n){var o=new r(e,t,this.me.peerId);o.addTarget(n),this.sendPacket(o)},e.prototype.sendPacketToUsers=function(e,t,n){var o=new r(e,t,this.me.peerId);n.length>0&&(n.forEach(function(e){o.addTarget(e)}),this.sendPacket(o))},e.prototype.sendPacketToAll=function(e,t){var n=new r(e,t,this.me.peerId);n.targets=[],this.sendPacket(n)},e.prototype.sendPacketToAllExcept=function(e,t,n){var o=this,s=new r(e,t,this.me.peerId);Object.keys(this.connectedUsersByPeerId).forEach(function(e){var t=o.connectedUsersByPeerId[e];t.peerId!==n.peerId&&s.addTarget(t)}),this.sendPacket(s)},e}();n.Realtime=c,cc._RF.pop()},{}],UISystem:[function(e,t,n){"use strict";cc._RF.push(t,"db67dbstYJHwLlIjZ6AlMlh","UISystem");var o=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),r=this&&this.__decorate||function(e,t,n,o){var r,s=arguments.length,c=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(c=(s<3?r(c):s>3?r(t,n,c):r(t,n))||c);return s>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0});var s=cc.Sprite,c=e("../../GamepadScreenResources"),a=e("../../../../Managers/Game/GameManager"),i=cc.Button,u=cc.Label,p=cc._decorator,f=p.ccclass,d=(p.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.onLoad=function(){this._resources=this.getComponent(c.default),this._gameManager=this.getComponent(a.default),this._connectingStage=cc.find("Canvas/UI/ConnectingStage"),this._disconnectedStage=cc.find("Canvas/UI/DisconnectedStage"),this._lobbyStage=cc.find("Canvas/UI/LobbyStage"),this._gameStage=cc.find("Canvas/UI/GameStage"),this._avatarSprite=cc.find("Canvas/UI/LobbyStage/AvatarSprite").getComponent(s),this._stateButton=cc.find("Canvas/UI/LobbyStage/StateButton").getComponent(i),this._stateButtonLabel=cc.find("Canvas/UI/LobbyStage/StateButton/Background/Label").getComponent(u)},t.prototype.start=function(){},t.prototype.changeAvatar=function(e){this._avatarSprite.spriteFrame=this._resources.avatarFrames[e]},t.prototype.changeState=function(e){var t=e?"READY":"UNREADY";this._stateButtonLabel.string=t},t.prototype.enableConnectingStage=function(){this.disableAllStages(),this._connectingStage.active=!0},t.prototype.enableDisconnectedStage=function(){this.disableAllStages(),this._disconnectedStage.active=!0},t.prototype.enableLobbyStage=function(){this.disableAllStages(),this._lobbyStage.active=!0},t.prototype.enableGameStage=function(){this.disableAllStages(),this._gameStage.active=!0},t.prototype.changeAvatarButtonClicked=function(e,t){var n=(this._gameManager.User.avatarId+parseInt(t))%this._resources.avatarFrames.length;n<0&&(n=this._resources.avatarFrames.length-1),void 0!==this.onChangeAvatarButtonClick&&this.onChangeAvatarButtonClick(n)},t.prototype.changeStateButtonClicked=function(){var e=this._gameManager.User.isReady;void 0!==this.onChangeStateButtonClick&&this.onChangeStateButtonClick(!e)},t.prototype.reconnectButtonClicked=function(){void 0!==this.onReconnectButtonClick&&this.onReconnectButtonClick()},t.prototype.disableAllStages=function(){this._connectingStage.active=!1,this._disconnectedStage.active=!1,this._lobbyStage.active=!1,this._gameStage.active=!1},t=r([f],t)}(cc.Component));n.default=d,cc._RF.pop()},{"../../../../Managers/Game/GameManager":"GameManager","../../GamepadScreenResources":"GamepadScreenResources"}],UserModel:[function(e,t,n){"use strict";cc._RF.push(t,"b07b8YL9ztEXbDw6cWHTJIS","UserModel"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){return function(){}}();n.UserModel=o,cc._RF.pop()},{}],WebSocketManager:[function(e,t,n){"use strict";cc._RF.push(t,"5d916u0bOBKd5tZd2978EI8","WebSocketManager");var o=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),r=this&&this.__decorate||function(e,t,n,o){var r,s=arguments.length,c=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(c=(s<3?r(c):s>3?r(t,n,c):r(t,n))||c);return s>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0});var s=cc._decorator,c=s.ccclass,a=(s.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.start=function(){},t.prototype.connect=function(e,t){var n=this;this._socket=new WebSocket("ws://"+e+":"+t),this._socket.onopen=function(){void 0!==n.onConnect&&n.onConnect()},this._socket.onclose=function(){void 0!==n.onDisconnect&&n.onDisconnect()},this._socket.onerror=function(){void 0!==n.onErrorOccur&&n.onErrorOccur()},this._socket.onmessage=function(e){void 0!==n.onMessageReceive&&n.onMessageReceive(e.data)}},t.prototype.disconnect=function(){this._socket.close(),this._socket.onopen=null,this._socket.onclose=null,this._socket.onerror=null,this._socket.onmessage=null},t.prototype.send=function(e){console.log(e.toJson()),this._socket.send(e.toJson())},t=r([c],t)}(cc.Component));n.default=a,cc._RF.pop()},{}]},{},["Helper","GameManager","Message","WebSocketManager","UserModel","Realtime","GamepadScreen","GamepadScreenResources","MessageCodes","MessageFactorySystem","ChangeAvatarMessage","ChangeStateMessage","UISystem"]);